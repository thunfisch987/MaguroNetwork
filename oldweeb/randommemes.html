<!DOCTYPE html>
<html>
	<head>
		<title>Just A Random Meme</title>
		<meta charset="utf-8" />
		<meta property="og:title" content="RandomMemes by Thun" />
		<meta property="og:type" content="website" />
		<meta
			property="og:url"
			content="https://oldweeb.littlebitgay.de/randommemes.html"
		/>
		<meta property="og:site_name" content="RandomMemes by Thun" />
		<meta property="og:description" content="!!! MIGHT BE CURSED !!!" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1, shrink-to-fit=no"
		/>
		<link rel="stylesheet" type="text/css" href="randommemes.css?rnd=9" />
		<script
			src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"
			integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
			crossorigin="anonymous"
		></script>
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/css/bootstrap.min.css"
			crossorigin="anonymous"
		/>
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/js/bootstrap.bundle.min.js"
			crossorigin="anonymous"
		></script>
	</head>
	<body>
		<!-- Age Verification -->
		<div
			class="
				d-flex
				flex-column
				min-vh-100
				justify-content-center
				text-center text-white
				mx-5
			"
			id="age"
		>
			<h3>Age Verification</h3>
			<hr />
			<p>
				Some memes on this website might be NSFW, continue with caution.
			</p>
			<div class="d-grid gap-1" id="">
				<button class="btn btn-success" onclick="enter()">Enter</button>
				<button class="btn btn-danger" onclick="exit()">Exit</button>
			</div>
		</div>

		<!-- Meme -->
		<img id="meme" alt="Here should be a meme" />

		<!-- Buttons -->
		<div
			id="btndiv"
			class="footer fixed-bottom text-center text-white"
			style="display: none"
		>
			<div class="row">
				<a
					type="button"
					class="col btn btn-success btn-lg btn-block"
					style="border-radius: 0 !important; opacity: 0.7 !important"
					id="downloadbutton"
					download=""
				>
					<span class="fs-2">&#129047; Download Image</span>
				</a>
				<button
					type="button"
					class="col btn btn-primary btn-lg btn-block"
					style="border-radius: 0 !important; opacity: 0.7 !important"
					onclick="randomImage()"
				>
					<span class="fs-2">&#x21bb; New Image</span>
				</button>
				<!-- <form
					action="download.php"
					method="post"
					enctype="multipart/form-data"
				>
					<input
						type="file"
						accept="image/*"
						name="fileToUpload"
						id="fileToUpload"
						class="fileToUpload"
						hidden
					/>
					<label for="fileToUpload" id="downloadbutton">
						<span id="downloadspan">&#8593; Upload Image</span>
						<span id="filename" style="display: none"></span>
					</label>
					<input
						type="submit"
						value="Upload Image"
						name="submit"
						id="submit"
					/>
				</form> -->
			</div>
		</div>
		<script>
			var fileNames = new Array();
			var age_elem = document.getElementById("age");
			var meme_elem = document.getElementById("meme");
			var btndiv_elem = document.getElementById("btndiv");
			var downloadbutton = document.getElementById("downloadbutton");
			const queryString = window.location.search;
			const urlParams = new URLSearchParams(queryString);

			document.onkeyup = function (event) {
				if (event.keyCode === 13) {
					randomImage();
				}
			};

			$.ajax({
				url: "memes/",
				success: function (data) {
					$(data)
						.find("td > a")
						.each(function () {
							fileNames.push($(this).attr("href"));
						});
				},
				complete: function (data) {
					fileNames.shift();
					//console.log({ fileNames });
					randomImage();
				},
			});

			$("#downloadbutton").attr({
				target: "_blank",
				href: meme_elem.src,
			});

			function enter() {
				document.cookie =
					"ageverify=1; SameSite=Lax; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/";
				age_elem.style.setProperty("display", "none", "important");
				meme_elem.style.display = "block";
				btndiv_elem.style.display = "block";
			}

			if (document.cookie.indexOf("ageverify=1") != -1) {
				age_elem.style.setProperty("display", "none", "important");
				meme_elem.style.display = "block";
				btndiv_elem.style.display = "block";
			} else {
				// jQuery("#cookieNotice").prependTo("body");
				// jQuery("#cookieNoticeCloser").show();
			}

			function exit() {
				window.location.href = "https://littlebitgay.de";
			}

			file = new String();
			function randomImage() {
				randomnumber = Math.floor(Math.random() * fileNames.length);
				console.log(randomnumber);
				file = "memes/" + fileNames[randomnumber];
				meme_elem.src = file;
				console.log(file);
				console.log(meme_elem.src);
				urlParams.set("id", randomnumber.toString);
				downloadbutton.setAttribute("download", file);
				downloadbutton.setAttribute("href", file);
			}
		</script>
	</body>
</html>
